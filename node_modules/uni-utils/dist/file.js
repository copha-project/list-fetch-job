"use strict";

const fs = require('fs');

const checkFile = async path => {
  let res = true;

  try {
    await require('fs').promises.stat(path);
  } catch (error) {
    res = false;
  }

  return res;
};

exports.checkFile = checkFile;
exports.fileExist = checkFile;

const checkFileSync = path => {
  let res = true;

  try {
    require('fs').statSync(path);
  } catch (error) {
    res = false;
  }

  return res;
};

exports.checkFileSync = checkFileSync;

const readFile = async (filePath, options = {}) => {
  return require('fs').promises.readFile(filePath, {
    encoding: 'utf-8',
    ...options
  });
};

exports.readFile = readFile;

const readFileSync = (filePath, options = {}) => {
  return require('fs').readFileSync(filePath, {
    encoding: 'utf-8',
    ...options
  });
};

exports.readFileSync = readFileSync;

const saveFile = async (data, filePath, options = {
  encoding: 'utf8'
}) => {
  await require('fs').promises.writeFile(filePath, data, options);
  return true;
};

exports.saveFile = saveFile;

const saveFileSync = (data, filePath) => {
  return require('fs').writeFile(filePath, data, err => {
    if (err) throw err;
  });
};

exports.saveFileSync = saveFileSync;

const getLastLine = async p => {
  const data = await readFile(p);
  const lines = data.split(require('os').EOL);
  return lines[lines.length - 1].trim() || lines[lines.length - 2].trim() || '';
};

exports.getLastLine = getLastLine;

const readJson = async p => {
  return JSON.parse(await readFile(p));
};

exports.readJson = readJson;

const readJsonSync = p => {
  return JSON.parse(readFileSync(p));
};

exports.readJsonSync = readJsonSync;

exports.readCsv = async (dp, options = {
  headers: false
}) => {
  const data = [];
  return new Promise((resolve, reject) => {
    fs.createReadStream(dp).pipe(require('fast-csv').parse(options)).on('error', error => reject(error)).on('data', row => data.push(row)).on('end', rowCount => {
      resolve(data);
    });
  });
};

const rm = p => {
  return new Promise((resolve, reject) => {
    require('rimraf')(p, e => {
      if (e) {
        reject(e);
      } else {
        resolve();
      }
    });
  });
};

exports.rm = rm;

const exportFile = async (data, filePath, type) => {
  let writeData;

  switch (type) {
    case 'csv':
      writeData = require('json2csv').parse(JSON.parse(JSON.stringify(data)));
      break;

    default:
      writeData = JSON.stringify(data);
  }

  return saveFile(writeData, filePath);
};

exports.exportFile = exportFile;

const copyFile = async (oldPath, newPath) => {
  return new Promise((resolve, reject) => {
    const readStream = fs.createReadStream(oldPath);
    const writeStream = fs.createWriteStream(newPath);
    readStream.on('error', reject);
    writeStream.on('error', reject);
    readStream.on('close', resolve);
    readStream.pipe(writeStream);
  });
};

exports.copyFile = copyFile;

const moveFile = (oldPath, newPath) => {
  return new Promise((resolve, reject) => {
    fs.rename(oldPath, newPath, err => {
      if (err) {
        if (err.code === 'EXDEV') {
          copyFile(oldPath, newPath).then(e => {
            fs.unlink(oldPath, () => {
              resolve();
            });
          }).catch(e => {
            throw new Error(e.message);
          });
        } else {
          throw new Error(err.message);
        }
      }

      resolve();
    });
  });
};

exports.moveFile = moveFile;

const saveJson = async (data, file) => {
  return saveFile(JSON.stringify(data, null, 4), file);
};

exports.saveJson = saveJson; // export const saveJson = async (data, file) => {
//     return saveFile(JSON.stringify(data, null, 4), file)
// }
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9maWxlLmpzIl0sIm5hbWVzIjpbImZzIiwicmVxdWlyZSIsImNoZWNrRmlsZSIsInBhdGgiLCJyZXMiLCJwcm9taXNlcyIsInN0YXQiLCJlcnJvciIsImV4cG9ydHMiLCJmaWxlRXhpc3QiLCJjaGVja0ZpbGVTeW5jIiwic3RhdFN5bmMiLCJyZWFkRmlsZSIsImZpbGVQYXRoIiwib3B0aW9ucyIsImVuY29kaW5nIiwicmVhZEZpbGVTeW5jIiwic2F2ZUZpbGUiLCJkYXRhIiwid3JpdGVGaWxlIiwic2F2ZUZpbGVTeW5jIiwiZXJyIiwiZ2V0TGFzdExpbmUiLCJwIiwibGluZXMiLCJzcGxpdCIsIkVPTCIsImxlbmd0aCIsInRyaW0iLCJyZWFkSnNvbiIsIkpTT04iLCJwYXJzZSIsInJlYWRKc29uU3luYyIsInJlYWRDc3YiLCJkcCIsImhlYWRlcnMiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImNyZWF0ZVJlYWRTdHJlYW0iLCJwaXBlIiwib24iLCJyb3ciLCJwdXNoIiwicm93Q291bnQiLCJybSIsImUiLCJleHBvcnRGaWxlIiwidHlwZSIsIndyaXRlRGF0YSIsInN0cmluZ2lmeSIsImNvcHlGaWxlIiwib2xkUGF0aCIsIm5ld1BhdGgiLCJyZWFkU3RyZWFtIiwid3JpdGVTdHJlYW0iLCJjcmVhdGVXcml0ZVN0cmVhbSIsIm1vdmVGaWxlIiwicmVuYW1lIiwiY29kZSIsInRoZW4iLCJ1bmxpbmsiLCJjYXRjaCIsIkVycm9yIiwibWVzc2FnZSIsInNhdmVKc29uIiwiZmlsZSJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxNQUFNQSxFQUFFLEdBQUdDLE9BQU8sQ0FBQyxJQUFELENBQWxCOztBQUVBLE1BQU1DLFNBQVMsR0FBRyxNQUFPQyxJQUFQLElBQWdCO0FBQzlCLE1BQUlDLEdBQUcsR0FBRyxJQUFWOztBQUNBLE1BQUk7QUFDQSxVQUFNSCxPQUFPLENBQUMsSUFBRCxDQUFQLENBQWNJLFFBQWQsQ0FBdUJDLElBQXZCLENBQTRCSCxJQUE1QixDQUFOO0FBQ0gsR0FGRCxDQUVFLE9BQU9JLEtBQVAsRUFBYztBQUNaSCxJQUFBQSxHQUFHLEdBQUcsS0FBTjtBQUNIOztBQUNELFNBQU9BLEdBQVA7QUFDSCxDQVJEOztBQVNBSSxPQUFPLENBQUNOLFNBQVIsR0FBb0JBLFNBQXBCO0FBQ0FNLE9BQU8sQ0FBQ0MsU0FBUixHQUFvQlAsU0FBcEI7O0FBRUEsTUFBTVEsYUFBYSxHQUFHUCxJQUFJLElBQUk7QUFDMUIsTUFBSUMsR0FBRyxHQUFHLElBQVY7O0FBQ0EsTUFBSTtBQUNBSCxJQUFBQSxPQUFPLENBQUMsSUFBRCxDQUFQLENBQWNVLFFBQWQsQ0FBdUJSLElBQXZCO0FBQ0gsR0FGRCxDQUVFLE9BQU9JLEtBQVAsRUFBYztBQUNaSCxJQUFBQSxHQUFHLEdBQUcsS0FBTjtBQUNIOztBQUNELFNBQU9BLEdBQVA7QUFDSCxDQVJEOztBQVNBSSxPQUFPLENBQUNFLGFBQVIsR0FBd0JBLGFBQXhCOztBQUVBLE1BQU1FLFFBQVEsR0FBRyxPQUFPQyxRQUFQLEVBQWlCQyxPQUFPLEdBQUMsRUFBekIsS0FBZ0M7QUFDN0MsU0FBT2IsT0FBTyxDQUFDLElBQUQsQ0FBUCxDQUFjSSxRQUFkLENBQXVCTyxRQUF2QixDQUFnQ0MsUUFBaEMsRUFBMEM7QUFBRUUsSUFBQUEsUUFBUSxFQUFFLE9BQVo7QUFBcUIsT0FBR0Q7QUFBeEIsR0FBMUMsQ0FBUDtBQUNILENBRkQ7O0FBR0FOLE9BQU8sQ0FBQ0ksUUFBUixHQUFtQkEsUUFBbkI7O0FBRUEsTUFBTUksWUFBWSxHQUFHLENBQUNILFFBQUQsRUFBV0MsT0FBTyxHQUFDLEVBQW5CLEtBQTBCO0FBQzNDLFNBQU9iLE9BQU8sQ0FBQyxJQUFELENBQVAsQ0FBY2UsWUFBZCxDQUEyQkgsUUFBM0IsRUFBcUM7QUFBRUUsSUFBQUEsUUFBUSxFQUFFLE9BQVo7QUFBcUIsT0FBR0Q7QUFBeEIsR0FBckMsQ0FBUDtBQUNILENBRkQ7O0FBR0FOLE9BQU8sQ0FBQ1EsWUFBUixHQUF1QkEsWUFBdkI7O0FBRUEsTUFBTUMsUUFBUSxHQUFHLE9BQU9DLElBQVAsRUFBYUwsUUFBYixFQUF1QkMsT0FBTyxHQUFHO0FBQUVDLEVBQUFBLFFBQVEsRUFBRTtBQUFaLENBQWpDLEtBQTBEO0FBQ3ZFLFFBQU1kLE9BQU8sQ0FBQyxJQUFELENBQVAsQ0FBY0ksUUFBZCxDQUF1QmMsU0FBdkIsQ0FBaUNOLFFBQWpDLEVBQTJDSyxJQUEzQyxFQUFpREosT0FBakQsQ0FBTjtBQUNBLFNBQU8sSUFBUDtBQUNILENBSEQ7O0FBSUFOLE9BQU8sQ0FBQ1MsUUFBUixHQUFtQkEsUUFBbkI7O0FBRUEsTUFBTUcsWUFBWSxHQUFHLENBQUNGLElBQUQsRUFBT0wsUUFBUCxLQUFvQjtBQUNyQyxTQUFPWixPQUFPLENBQUMsSUFBRCxDQUFQLENBQWNrQixTQUFkLENBQXdCTixRQUF4QixFQUFrQ0ssSUFBbEMsRUFBeUNHLEdBQUQsSUFBTztBQUNsRCxRQUFJQSxHQUFKLEVBQVMsTUFBTUEsR0FBTjtBQUNaLEdBRk0sQ0FBUDtBQUdILENBSkQ7O0FBS0FiLE9BQU8sQ0FBQ1ksWUFBUixHQUF1QkEsWUFBdkI7O0FBRUEsTUFBTUUsV0FBVyxHQUFHLE1BQU9DLENBQVAsSUFBYTtBQUM3QixRQUFNTCxJQUFJLEdBQUcsTUFBTU4sUUFBUSxDQUFDVyxDQUFELENBQTNCO0FBQ0EsUUFBTUMsS0FBSyxHQUFHTixJQUFJLENBQUNPLEtBQUwsQ0FBV3hCLE9BQU8sQ0FBQyxJQUFELENBQVAsQ0FBY3lCLEdBQXpCLENBQWQ7QUFDQSxTQUFPRixLQUFLLENBQUNBLEtBQUssQ0FBQ0csTUFBTixHQUFlLENBQWhCLENBQUwsQ0FBd0JDLElBQXhCLE1BQWtDSixLQUFLLENBQUNBLEtBQUssQ0FBQ0csTUFBTixHQUFlLENBQWhCLENBQUwsQ0FBd0JDLElBQXhCLEVBQWxDLElBQW9FLEVBQTNFO0FBQ0gsQ0FKRDs7QUFLQXBCLE9BQU8sQ0FBQ2MsV0FBUixHQUFzQkEsV0FBdEI7O0FBRUEsTUFBTU8sUUFBUSxHQUFHLE1BQU9OLENBQVAsSUFBYTtBQUMxQixTQUFPTyxJQUFJLENBQUNDLEtBQUwsQ0FBVyxNQUFNbkIsUUFBUSxDQUFDVyxDQUFELENBQXpCLENBQVA7QUFDSCxDQUZEOztBQUdBZixPQUFPLENBQUNxQixRQUFSLEdBQW1CQSxRQUFuQjs7QUFFQSxNQUFNRyxZQUFZLEdBQUdULENBQUMsSUFBSTtBQUN0QixTQUFPTyxJQUFJLENBQUNDLEtBQUwsQ0FBV2YsWUFBWSxDQUFDTyxDQUFELENBQXZCLENBQVA7QUFDSCxDQUZEOztBQUdBZixPQUFPLENBQUN3QixZQUFSLEdBQXVCQSxZQUF2Qjs7QUFFQXhCLE9BQU8sQ0FBQ3lCLE9BQVIsR0FBa0IsT0FBT0MsRUFBUCxFQUFVcEIsT0FBTyxHQUFDO0FBQUNxQixFQUFBQSxPQUFPLEVBQUU7QUFBVixDQUFsQixLQUF1QztBQUNyRCxRQUFNakIsSUFBSSxHQUFHLEVBQWI7QUFDQSxTQUFPLElBQUlrQixPQUFKLENBQVksQ0FBQ0MsT0FBRCxFQUFTQyxNQUFULEtBQWtCO0FBQ2pDdEMsSUFBQUEsRUFBRSxDQUFDdUMsZ0JBQUgsQ0FBb0JMLEVBQXBCLEVBQ0NNLElBREQsQ0FDTXZDLE9BQU8sQ0FBQyxVQUFELENBQVAsQ0FBb0I4QixLQUFwQixDQUEwQmpCLE9BQTFCLENBRE4sRUFFQzJCLEVBRkQsQ0FFSSxPQUZKLEVBRWFsQyxLQUFLLElBQUkrQixNQUFNLENBQUMvQixLQUFELENBRjVCLEVBR0NrQyxFQUhELENBR0ksTUFISixFQUdZQyxHQUFHLElBQUl4QixJQUFJLENBQUN5QixJQUFMLENBQVVELEdBQVYsQ0FIbkIsRUFJQ0QsRUFKRCxDQUlJLEtBSkosRUFJV0csUUFBUSxJQUFJO0FBQ25CUCxNQUFBQSxPQUFPLENBQUNuQixJQUFELENBQVA7QUFDSCxLQU5EO0FBT0gsR0FSTSxDQUFQO0FBU0gsQ0FYRDs7QUFhQSxNQUFNMkIsRUFBRSxHQUFJdEIsQ0FBRCxJQUFPO0FBQ2QsU0FBTyxJQUFJYSxPQUFKLENBQVksQ0FBQ0MsT0FBRCxFQUFVQyxNQUFWLEtBQXFCO0FBQ3BDckMsSUFBQUEsT0FBTyxDQUFDLFFBQUQsQ0FBUCxDQUFrQnNCLENBQWxCLEVBQXNCdUIsQ0FBRCxJQUFPO0FBQ3hCLFVBQUlBLENBQUosRUFBTztBQUNIUixRQUFBQSxNQUFNLENBQUNRLENBQUQsQ0FBTjtBQUNILE9BRkQsTUFFTztBQUNIVCxRQUFBQSxPQUFPO0FBQ1Y7QUFDSixLQU5EO0FBT0gsR0FSTSxDQUFQO0FBU0gsQ0FWRDs7QUFXQTdCLE9BQU8sQ0FBQ3FDLEVBQVIsR0FBYUEsRUFBYjs7QUFFQSxNQUFNRSxVQUFVLEdBQUcsT0FBTzdCLElBQVAsRUFBYUwsUUFBYixFQUF1Qm1DLElBQXZCLEtBQWdDO0FBQy9DLE1BQUlDLFNBQUo7O0FBQ0EsVUFBUUQsSUFBUjtBQUNJLFNBQUssS0FBTDtBQUNJQyxNQUFBQSxTQUFTLEdBQUdoRCxPQUFPLENBQUMsVUFBRCxDQUFQLENBQW9COEIsS0FBcEIsQ0FBMEJELElBQUksQ0FBQ0MsS0FBTCxDQUFXRCxJQUFJLENBQUNvQixTQUFMLENBQWVoQyxJQUFmLENBQVgsQ0FBMUIsQ0FBWjtBQUNBOztBQUNKO0FBQ0krQixNQUFBQSxTQUFTLEdBQUduQixJQUFJLENBQUNvQixTQUFMLENBQWVoQyxJQUFmLENBQVo7QUFMUjs7QUFPQSxTQUFPRCxRQUFRLENBQUNnQyxTQUFELEVBQVlwQyxRQUFaLENBQWY7QUFDSCxDQVZEOztBQVdBTCxPQUFPLENBQUN1QyxVQUFSLEdBQXFCQSxVQUFyQjs7QUFFQSxNQUFNSSxRQUFRLEdBQUcsT0FBT0MsT0FBUCxFQUFnQkMsT0FBaEIsS0FBNEI7QUFDekMsU0FBTyxJQUFJakIsT0FBSixDQUFZLENBQUNDLE9BQUQsRUFBVUMsTUFBVixLQUFxQjtBQUNwQyxVQUFNZ0IsVUFBVSxHQUFHdEQsRUFBRSxDQUFDdUMsZ0JBQUgsQ0FBb0JhLE9BQXBCLENBQW5CO0FBQ0EsVUFBTUcsV0FBVyxHQUFHdkQsRUFBRSxDQUFDd0QsaUJBQUgsQ0FBcUJILE9BQXJCLENBQXBCO0FBQ0FDLElBQUFBLFVBQVUsQ0FBQ2IsRUFBWCxDQUFjLE9BQWQsRUFBdUJILE1BQXZCO0FBQ0FpQixJQUFBQSxXQUFXLENBQUNkLEVBQVosQ0FBZSxPQUFmLEVBQXdCSCxNQUF4QjtBQUNBZ0IsSUFBQUEsVUFBVSxDQUFDYixFQUFYLENBQWMsT0FBZCxFQUF1QkosT0FBdkI7QUFDQWlCLElBQUFBLFVBQVUsQ0FBQ2QsSUFBWCxDQUFnQmUsV0FBaEI7QUFDSCxHQVBNLENBQVA7QUFRSCxDQVREOztBQVVBL0MsT0FBTyxDQUFDMkMsUUFBUixHQUFtQkEsUUFBbkI7O0FBRUEsTUFBTU0sUUFBUSxHQUFHLENBQUNMLE9BQUQsRUFBVUMsT0FBVixLQUFzQjtBQUNuQyxTQUFPLElBQUlqQixPQUFKLENBQVksQ0FBQ0MsT0FBRCxFQUFVQyxNQUFWLEtBQXFCO0FBQ3BDdEMsSUFBQUEsRUFBRSxDQUFDMEQsTUFBSCxDQUFVTixPQUFWLEVBQW1CQyxPQUFuQixFQUE2QmhDLEdBQUQsSUFBUztBQUNqQyxVQUFJQSxHQUFKLEVBQVM7QUFDTCxZQUFJQSxHQUFHLENBQUNzQyxJQUFKLEtBQWEsT0FBakIsRUFBMEI7QUFDdEJSLFVBQUFBLFFBQVEsQ0FBQ0MsT0FBRCxFQUFVQyxPQUFWLENBQVIsQ0FBMkJPLElBQTNCLENBQWdDZCxDQUFDLElBQUk7QUFDakM5QyxZQUFBQSxFQUFFLENBQUM2RCxNQUFILENBQVVULE9BQVYsRUFBbUIsTUFBTTtBQUNyQmYsY0FBQUEsT0FBTztBQUNWLGFBRkQ7QUFHSCxXQUpELEVBSUd5QixLQUpILENBSVNoQixDQUFDLElBQUk7QUFDVixrQkFBTSxJQUFJaUIsS0FBSixDQUFVakIsQ0FBQyxDQUFDa0IsT0FBWixDQUFOO0FBQ0gsV0FORDtBQU9ILFNBUkQsTUFRTztBQUNILGdCQUFNLElBQUlELEtBQUosQ0FBVTFDLEdBQUcsQ0FBQzJDLE9BQWQsQ0FBTjtBQUNIO0FBQ0o7O0FBQ0QzQixNQUFBQSxPQUFPO0FBQ1YsS0FmRDtBQWdCSCxHQWpCTSxDQUFQO0FBa0JILENBbkJEOztBQW9CQTdCLE9BQU8sQ0FBQ2lELFFBQVIsR0FBbUJBLFFBQW5COztBQUVBLE1BQU1RLFFBQVEsR0FBRyxPQUFPL0MsSUFBUCxFQUFhZ0QsSUFBYixLQUFzQjtBQUNuQyxTQUFPakQsUUFBUSxDQUFDYSxJQUFJLENBQUNvQixTQUFMLENBQWVoQyxJQUFmLEVBQXFCLElBQXJCLEVBQTJCLENBQTNCLENBQUQsRUFBZ0NnRCxJQUFoQyxDQUFmO0FBQ0gsQ0FGRDs7QUFHQTFELE9BQU8sQ0FBQ3lELFFBQVIsR0FBbUJBLFFBQW5CLEMsQ0FFQTtBQUNBO0FBQ0EiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJylcblxuY29uc3QgY2hlY2tGaWxlID0gYXN5bmMgKHBhdGgpID0+IHtcbiAgICBsZXQgcmVzID0gdHJ1ZVxuICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHJlcXVpcmUoJ2ZzJykucHJvbWlzZXMuc3RhdChwYXRoKVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJlcyA9IGZhbHNlXG4gICAgfVxuICAgIHJldHVybiByZXNcbn1cbmV4cG9ydHMuY2hlY2tGaWxlID0gY2hlY2tGaWxlXG5leHBvcnRzLmZpbGVFeGlzdCA9IGNoZWNrRmlsZVxuXG5jb25zdCBjaGVja0ZpbGVTeW5jID0gcGF0aCA9PiB7XG4gICAgbGV0IHJlcyA9IHRydWVcbiAgICB0cnkge1xuICAgICAgICByZXF1aXJlKCdmcycpLnN0YXRTeW5jKHBhdGgpXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmVzID0gZmFsc2VcbiAgICB9XG4gICAgcmV0dXJuIHJlc1xufVxuZXhwb3J0cy5jaGVja0ZpbGVTeW5jID0gY2hlY2tGaWxlU3luY1xuXG5jb25zdCByZWFkRmlsZSA9IGFzeW5jIChmaWxlUGF0aCwgb3B0aW9ucz17fSkgPT4ge1xuICAgIHJldHVybiByZXF1aXJlKCdmcycpLnByb21pc2VzLnJlYWRGaWxlKGZpbGVQYXRoLCB7IGVuY29kaW5nOiAndXRmLTgnLCAuLi5vcHRpb25zIH0pXG59XG5leHBvcnRzLnJlYWRGaWxlID0gcmVhZEZpbGVcblxuY29uc3QgcmVhZEZpbGVTeW5jID0gKGZpbGVQYXRoLCBvcHRpb25zPXt9KSA9PiB7XG4gICAgcmV0dXJuIHJlcXVpcmUoJ2ZzJykucmVhZEZpbGVTeW5jKGZpbGVQYXRoLCB7IGVuY29kaW5nOiAndXRmLTgnLCAuLi5vcHRpb25zIH0pXG59XG5leHBvcnRzLnJlYWRGaWxlU3luYyA9IHJlYWRGaWxlU3luY1xuXG5jb25zdCBzYXZlRmlsZSA9IGFzeW5jIChkYXRhLCBmaWxlUGF0aCwgb3B0aW9ucyA9IHsgZW5jb2Rpbmc6ICd1dGY4JyB9KSA9PiB7XG4gICAgYXdhaXQgcmVxdWlyZSgnZnMnKS5wcm9taXNlcy53cml0ZUZpbGUoZmlsZVBhdGgsIGRhdGEsIG9wdGlvbnMpXG4gICAgcmV0dXJuIHRydWVcbn1cbmV4cG9ydHMuc2F2ZUZpbGUgPSBzYXZlRmlsZVxuXG5jb25zdCBzYXZlRmlsZVN5bmMgPSAoZGF0YSwgZmlsZVBhdGgpID0+IHtcbiAgICByZXR1cm4gcmVxdWlyZSgnZnMnKS53cml0ZUZpbGUoZmlsZVBhdGgsIGRhdGEsIChlcnIpPT57XG4gICAgICAgIGlmIChlcnIpIHRocm93IGVyclxuICAgIH0pXG59XG5leHBvcnRzLnNhdmVGaWxlU3luYyA9IHNhdmVGaWxlU3luY1xuXG5jb25zdCBnZXRMYXN0TGluZSA9IGFzeW5jIChwKSA9PiB7XG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlYWRGaWxlKHApXG4gICAgY29uc3QgbGluZXMgPSBkYXRhLnNwbGl0KHJlcXVpcmUoJ29zJykuRU9MKVxuICAgIHJldHVybiBsaW5lc1tsaW5lcy5sZW5ndGggLSAxXS50cmltKCkgfHwgbGluZXNbbGluZXMubGVuZ3RoIC0gMl0udHJpbSgpIHx8ICcnXG59XG5leHBvcnRzLmdldExhc3RMaW5lID0gZ2V0TGFzdExpbmVcblxuY29uc3QgcmVhZEpzb24gPSBhc3luYyAocCkgPT4ge1xuICAgIHJldHVybiBKU09OLnBhcnNlKGF3YWl0IHJlYWRGaWxlKHApKVxufVxuZXhwb3J0cy5yZWFkSnNvbiA9IHJlYWRKc29uXG5cbmNvbnN0IHJlYWRKc29uU3luYyA9IHAgPT4ge1xuICAgIHJldHVybiBKU09OLnBhcnNlKHJlYWRGaWxlU3luYyhwKSlcbn1cbmV4cG9ydHMucmVhZEpzb25TeW5jID0gcmVhZEpzb25TeW5jXG5cbmV4cG9ydHMucmVhZENzdiA9IGFzeW5jIChkcCxvcHRpb25zPXtoZWFkZXJzOiBmYWxzZX0pID0+IHtcbiAgICBjb25zdCBkYXRhID0gW11cbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUscmVqZWN0KT0+e1xuICAgICAgICBmcy5jcmVhdGVSZWFkU3RyZWFtKGRwKVxuICAgICAgICAucGlwZShyZXF1aXJlKCdmYXN0LWNzdicpLnBhcnNlKG9wdGlvbnMpKVxuICAgICAgICAub24oJ2Vycm9yJywgZXJyb3IgPT4gcmVqZWN0KGVycm9yKSlcbiAgICAgICAgLm9uKCdkYXRhJywgcm93ID0+IGRhdGEucHVzaChyb3cpKVxuICAgICAgICAub24oJ2VuZCcsIHJvd0NvdW50ID0+IHtcbiAgICAgICAgICAgIHJlc29sdmUoZGF0YSlcbiAgICAgICAgfSlcbiAgICB9KVxufVxuXG5jb25zdCBybSA9IChwKSA9PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgcmVxdWlyZSgncmltcmFmJykocCwgKGUpID0+IHtcbiAgICAgICAgICAgIGlmIChlKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGUpXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc29sdmUoKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgIH0pXG59XG5leHBvcnRzLnJtID0gcm1cblxuY29uc3QgZXhwb3J0RmlsZSA9IGFzeW5jIChkYXRhLCBmaWxlUGF0aCwgdHlwZSkgPT4ge1xuICAgIGxldCB3cml0ZURhdGFcbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgY2FzZSAnY3N2JzpcbiAgICAgICAgICAgIHdyaXRlRGF0YSA9IHJlcXVpcmUoJ2pzb24yY3N2JykucGFyc2UoSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSkpXG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHdyaXRlRGF0YSA9IEpTT04uc3RyaW5naWZ5KGRhdGEpXG4gICAgfVxuICAgIHJldHVybiBzYXZlRmlsZSh3cml0ZURhdGEsIGZpbGVQYXRoKVxufVxuZXhwb3J0cy5leHBvcnRGaWxlID0gZXhwb3J0RmlsZVxuXG5jb25zdCBjb3B5RmlsZSA9IGFzeW5jIChvbGRQYXRoLCBuZXdQYXRoKSA9PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgY29uc3QgcmVhZFN0cmVhbSA9IGZzLmNyZWF0ZVJlYWRTdHJlYW0ob2xkUGF0aClcbiAgICAgICAgY29uc3Qgd3JpdGVTdHJlYW0gPSBmcy5jcmVhdGVXcml0ZVN0cmVhbShuZXdQYXRoKVxuICAgICAgICByZWFkU3RyZWFtLm9uKCdlcnJvcicsIHJlamVjdClcbiAgICAgICAgd3JpdGVTdHJlYW0ub24oJ2Vycm9yJywgcmVqZWN0KVxuICAgICAgICByZWFkU3RyZWFtLm9uKCdjbG9zZScsIHJlc29sdmUpXG4gICAgICAgIHJlYWRTdHJlYW0ucGlwZSh3cml0ZVN0cmVhbSlcbiAgICB9KVxufVxuZXhwb3J0cy5jb3B5RmlsZSA9IGNvcHlGaWxlXG5cbmNvbnN0IG1vdmVGaWxlID0gKG9sZFBhdGgsIG5ld1BhdGgpID0+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBmcy5yZW5hbWUob2xkUGF0aCwgbmV3UGF0aCwgKGVycikgPT4ge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIGlmIChlcnIuY29kZSA9PT0gJ0VYREVWJykge1xuICAgICAgICAgICAgICAgICAgICBjb3B5RmlsZShvbGRQYXRoLCBuZXdQYXRoKS50aGVuKGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZnMudW5saW5rKG9sZFBhdGgsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKClcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGUubWVzc2FnZSlcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyLm1lc3NhZ2UpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVzb2x2ZSgpXG4gICAgICAgIH0pXG4gICAgfSlcbn1cbmV4cG9ydHMubW92ZUZpbGUgPSBtb3ZlRmlsZVxuXG5jb25zdCBzYXZlSnNvbiA9IGFzeW5jIChkYXRhLCBmaWxlKSA9PiB7XG4gICAgcmV0dXJuIHNhdmVGaWxlKEpTT04uc3RyaW5naWZ5KGRhdGEsIG51bGwsIDQpLCBmaWxlKVxufVxuZXhwb3J0cy5zYXZlSnNvbiA9IHNhdmVKc29uXG5cbi8vIGV4cG9ydCBjb25zdCBzYXZlSnNvbiA9IGFzeW5jIChkYXRhLCBmaWxlKSA9PiB7XG4vLyAgICAgcmV0dXJuIHNhdmVGaWxlKEpTT04uc3RyaW5naWZ5KGRhdGEsIG51bGwsIDQpLCBmaWxlKVxuLy8gfVxuIl19