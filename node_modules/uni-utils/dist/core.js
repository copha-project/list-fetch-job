"use strict";

const {
  sleep
} = require('./time');

const log = (...i) => {
  console.log(new Date().toLocaleString(), '|', JSON.stringify(i, null, 2));
};

exports.log = log;

const removeDuplicate = (arr, key = 'id') => {
  if (JSON.stringify(arr[0])[0] === '{') {
    return arr.filter((item, index, self) => self.findIndex(t => t[key] === item[key]) === index);
  } else {
    return [...new Set(arr)];
  }
};

exports.removeDuplicate = removeDuplicate;

const arrayRemove = (arr, ...args) => {
  let what,
      a = args,
      L = a.length,
      ax;

  while (L >= 1 && arr.length) {
    what = a[--L];

    while ((ax = arr.indexOf(what)) !== -1) {
      arr.splice(ax, 1);
    }
  }

  return arr;
};

exports.arrayRemove = arrayRemove;

const range = (a, b) => {
  const g = function* () {
    while (a <= b) {
      yield a++;
    }
  };

  return [...g()];
};

exports.range = range;

const loopTask = async (data, func, options) => {
  options = {
    execLength: 10,
    timeGap: 1000,
    ...options
  };
  const results = [];

  const cliProgress = require('cli-progress');

  const infoBar = new cliProgress.SingleBar({
    fps: 100
  }, cliProgress.Presets.shades_classic);
  infoBar.start(data.length, 1);

  for (let i = 0; i < data.length; i += +options.execLength) {
    const subData = data.slice(i, i + +options.execLength);
    const taskMap = subData.map(e => func(e));

    for (const j in taskMap) {
      const res = await taskMap[j];
      infoBar.update(i + +j + 1);
      results.push(res);
    }

    await sleep(options.timeGap);
  }

  infoBar.stop();
  return results;
};

exports.loopTask = loopTask;

const randomStr = (len, type = 1) => {
  let result = '';
  const commonCharacters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
  const UpCharacters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  const Numbers = '0123456789';
  let characters = commonCharacters;

  if (type == 2) {
    characters = UpCharacters;
  } else if (type == 3) {
    characters = Numbers;
  }

  const charactersLength = characters.length;

  for (let i = 0; i < len; i++) {
    result += characters.charAt(Math.floor(Math.random() * charactersLength));
  }

  return result;
};

exports.randomStr = randomStr;

const randomNum = (len = 1) => {
  return len === 1 ? Math.floor(Math.random() * 10) : Math.floor(Math.random() * 9 * 10 ** (len - 1) + 10 ** (len - 1));
};

exports.randomNum = randomNum;

const uuid = (v = "v1", ...args) => {
  return require('uuid')[v](...args);
};

exports.uuid = uuid;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb3JlLmpzIl0sIm5hbWVzIjpbInNsZWVwIiwicmVxdWlyZSIsImxvZyIsImkiLCJjb25zb2xlIiwiRGF0ZSIsInRvTG9jYWxlU3RyaW5nIiwiSlNPTiIsInN0cmluZ2lmeSIsImV4cG9ydHMiLCJyZW1vdmVEdXBsaWNhdGUiLCJhcnIiLCJrZXkiLCJmaWx0ZXIiLCJpdGVtIiwiaW5kZXgiLCJzZWxmIiwiZmluZEluZGV4IiwidCIsIlNldCIsImFycmF5UmVtb3ZlIiwiYXJncyIsIndoYXQiLCJhIiwiTCIsImxlbmd0aCIsImF4IiwiaW5kZXhPZiIsInNwbGljZSIsInJhbmdlIiwiYiIsImciLCJsb29wVGFzayIsImRhdGEiLCJmdW5jIiwib3B0aW9ucyIsImV4ZWNMZW5ndGgiLCJ0aW1lR2FwIiwicmVzdWx0cyIsImNsaVByb2dyZXNzIiwiaW5mb0JhciIsIlNpbmdsZUJhciIsImZwcyIsIlByZXNldHMiLCJzaGFkZXNfY2xhc3NpYyIsInN0YXJ0Iiwic3ViRGF0YSIsInNsaWNlIiwidGFza01hcCIsIm1hcCIsImUiLCJqIiwicmVzIiwidXBkYXRlIiwicHVzaCIsInN0b3AiLCJyYW5kb21TdHIiLCJsZW4iLCJ0eXBlIiwicmVzdWx0IiwiY29tbW9uQ2hhcmFjdGVycyIsIlVwQ2hhcmFjdGVycyIsIk51bWJlcnMiLCJjaGFyYWN0ZXJzIiwiY2hhcmFjdGVyc0xlbmd0aCIsImNoYXJBdCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInJhbmRvbU51bSIsInV1aWQiLCJ2Il0sIm1hcHBpbmdzIjoiOztBQUFBLE1BQU07QUFBQ0EsRUFBQUE7QUFBRCxJQUFVQyxPQUFPLENBQUMsUUFBRCxDQUF2Qjs7QUFDQSxNQUFNQyxHQUFHLEdBQUcsQ0FBQyxHQUFHQyxDQUFKLEtBQVU7QUFDbEJDLEVBQUFBLE9BQU8sQ0FBQ0YsR0FBUixDQUFZLElBQUlHLElBQUosR0FBV0MsY0FBWCxFQUFaLEVBQXdDLEdBQXhDLEVBQTRDQyxJQUFJLENBQUNDLFNBQUws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LEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHc0QsR0FBcEIsRUFBeUJ0RCxDQUFDLEVBQTFCLEVBQThCO0FBQzVCd0QsSUFBQUEsTUFBTSxJQUFJSSxVQUFVLENBQUNFLE1BQVgsQ0FBa0JDLElBQUksQ0FBQ0MsS0FBTCxDQUFXRCxJQUFJLENBQUNFLE1BQUwsS0FBZ0JKLGdCQUEzQixDQUFsQixDQUFWO0FBQ0Q7O0FBQ0QsU0FBT0wsTUFBUDtBQUNILENBaEJEOztBQWlCQWxELE9BQU8sQ0FBQytDLFNBQVIsR0FBb0JBLFNBQXBCOztBQUVBLE1BQU1hLFNBQVMsR0FBRyxDQUFDWixHQUFHLEdBQUcsQ0FBUCxLQUFhO0FBQzNCLFNBQU9BLEdBQUcsS0FBSyxDQUFSLEdBQVlTLElBQUksQ0FBQ0MsS0FBTCxDQUFXRCxJQUFJLENBQUNFLE1BQUwsS0FBYyxFQUF6QixDQUFaLEdBQTJDRixJQUFJLENBQUNDLEtBQUwsQ0FBV0QsSUFBSSxDQUFDRSxNQUFMLEtBQWdCLENBQWhCLEdBQW1CLE9BQUtYLEdBQUcsR0FBQyxDQUFULENBQW5CLEdBQWtDLE9BQU9BLEdBQUcsR0FBQyxDQUFYLENBQTdDLENBQWxEO0FBQ0gsQ0FGRDs7QUFHQWhELE9BQU8sQ0FBQzRELFNBQVIsR0FBb0JBLFNBQXBCOztBQUVBLE1BQU1DLElBQUksR0FBRyxDQUFDQyxDQUFDLEdBQUMsSUFBSCxFQUFTLEdBQUdsRCxJQUFaLEtBQXFCO0FBQzlCLFNBQU9wQixPQUFPLENBQUMsTUFBRCxDQUFQLENBQWdCc0UsQ0FBaEIsRUFBbUIsR0FBR2xELElBQXRCLENBQVA7QUFDSCxDQUZEOztBQUdBWixPQUFPLENBQUM2RCxJQUFSLEdBQWVBLElBQWYiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7c2xlZXB9ID0gcmVxdWlyZSgnLi90aW1lJylcbmNvbnN0IGxvZyA9ICguLi5pKSA9PiB7XG4gICAgY29uc29sZS5sb2cobmV3IERhdGUoKS50b0xvY2FsZVN0cmluZygpLCd8JyxKU09OLnN0cmluZ2lmeShpLCBudWxsLCAyKSlcbn1cbmV4cG9ydHMubG9nID0gbG9nXG5cbmNvbnN0IHJlbW92ZUR1cGxpY2F0ZSA9IChhcnIsIGtleSA9ICdpZCcpID0+IHtcbiAgICBpZihKU09OLnN0cmluZ2lmeShhcnJbMF0pWzBdPT09J3snKXtcbiAgICAgICAgcmV0dXJuIGFyci5maWx0ZXIoKGl0ZW0sIGluZGV4LCBzZWxmKSA9PiBzZWxmLmZpbmRJbmRleCh0ID0+IHRba2V5XSA9PT0gaXRlbVtrZXldKSA9PT0gaW5kZXgpXG4gICAgfWVsc2V7XG4gICAgICAgIHJldHVybiBbLi4ubmV3IFNldChhcnIpXVxuICAgIH1cbn1cbmV4cG9ydHMucmVtb3ZlRHVwbGljYXRlID0gcmVtb3ZlRHVwbGljYXRlXG5cbmNvbnN0IGFycmF5UmVtb3ZlID0gKGFyciwuLi5hcmdzKSA9PiAge1xuICAgIGxldCB3aGF0LCBhID0gYXJncywgTCA9IGEubGVuZ3RoLCBheFxuICAgIHdoaWxlIChMID49IDEgJiYgYXJyLmxlbmd0aCkge1xuICAgICAgICB3aGF0ID0gYVstLUxdXG4gICAgICAgIHdoaWxlICgoYXggPSBhcnIuaW5kZXhPZih3aGF0KSkgIT09IC0xKSB7XG4gICAgICAgICAgICBhcnIuc3BsaWNlKGF4LCAxKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gYXJyXG59XG5leHBvcnRzLmFycmF5UmVtb3ZlID0gYXJyYXlSZW1vdmVcblxuY29uc3QgcmFuZ2UgPSAoYSwgYikgPT4ge1xuICAgIGNvbnN0IGcgPSBmdW5jdGlvbiogKCkge1xuICAgICAgICB3aGlsZSAoYSA8PSBiKSB7XG4gICAgICAgICAgICB5aWVsZCBhKytcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gWy4uLmcoKV1cbn1cbmV4cG9ydHMucmFuZ2UgPSByYW5nZVxuXG5jb25zdCBsb29wVGFzayA9IGFzeW5jIChkYXRhLCBmdW5jLCBvcHRpb25zKSA9PiB7XG4gICAgb3B0aW9ucyA9IHsgZXhlY0xlbmd0aDogMTAsIHRpbWVHYXA6IDEwMDAsIC4uLm9wdGlvbnMgfVxuICAgIGNvbnN0IHJlc3VsdHMgPSBbXVxuICAgIGNvbnN0IGNsaVByb2dyZXNzID0gcmVxdWlyZSgnY2xpLXByb2dyZXNzJylcbiAgICBjb25zdCBpbmZvQmFyID0gbmV3IGNsaVByb2dyZXNzLlNpbmdsZUJhcih7XG4gICAgICAgIGZwczogMTAwXG4gICAgfSwgY2xpUHJvZ3Jlc3MuUHJlc2V0cy5zaGFkZXNfY2xhc3NpYyk7XG4gICAgaW5mb0Jhci5zdGFydChkYXRhLmxlbmd0aCwgMSlcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpICs9ICtvcHRpb25zLmV4ZWNMZW5ndGgpIHtcbiAgICAgICAgY29uc3Qgc3ViRGF0YSA9IGRhdGEuc2xpY2UoaSwgaSArICtvcHRpb25zLmV4ZWNMZW5ndGgpXG4gICAgICAgIGNvbnN0IHRhc2tNYXAgPSBzdWJEYXRhLm1hcChlID0+IGZ1bmMoZSkpXG4gICAgICAgIGZvciAoY29uc3QgaiBpbiB0YXNrTWFwKSB7XG4gICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB0YXNrTWFwW2pdXG4gICAgICAgICAgICBpbmZvQmFyLnVwZGF0ZShpICsgK2ogKyAxKVxuICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHJlcylcbiAgICAgICAgfVxuICAgICAgICBhd2FpdCBzbGVlcChvcHRpb25zLnRpbWVHYXApXG5cbiAgICB9XG4gICAgaW5mb0Jhci5zdG9wKClcbiAgICByZXR1cm4gcmVzdWx0c1xufVxuZXhwb3J0cy5sb29wVGFzayA9IGxvb3BUYXNrXG5cbmNvbnN0IHJhbmRvbVN0ciA9IChsZW4sdHlwZT0xKSA9PiB7XG4gICAgbGV0IHJlc3VsdCA9ICcnXG4gICAgY29uc3QgY29tbW9uQ2hhcmFjdGVycyA9ICdBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSdcbiAgICBjb25zdCBVcENoYXJhY3RlcnMgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVowMTIzNDU2Nzg5J1xuICAgIGNvbnN0IE51bWJlcnMgPSAnMDEyMzQ1Njc4OSdcbiAgICBsZXQgY2hhcmFjdGVycyA9IGNvbW1vbkNoYXJhY3RlcnNcbiAgICBpZih0eXBlPT0yKXtcbiAgICAgIGNoYXJhY3RlcnMgPSBVcENoYXJhY3RlcnNcbiAgICB9ZWxzZSBpZih0eXBlPT0zKXtcbiAgICAgIGNoYXJhY3RlcnMgPSBOdW1iZXJzXG4gICAgfVxuICAgIGNvbnN0IGNoYXJhY3RlcnNMZW5ndGggPSBjaGFyYWN0ZXJzLmxlbmd0aFxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIHJlc3VsdCArPSBjaGFyYWN0ZXJzLmNoYXJBdChNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBjaGFyYWN0ZXJzTGVuZ3RoKSlcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdFxufVxuZXhwb3J0cy5yYW5kb21TdHIgPSByYW5kb21TdHJcblxuY29uc3QgcmFuZG9tTnVtID0gKGxlbiA9IDEpID0+IHtcbiAgICByZXR1cm4gbGVuID09PSAxID8gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKjEwKSA6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDkqKDEwKioobGVuLTEpKSArIDEwICoqIChsZW4tMSkpXG59XG5leHBvcnRzLnJhbmRvbU51bSA9IHJhbmRvbU51bVxuXG5jb25zdCB1dWlkID0gKHY9XCJ2MVwiLCAuLi5hcmdzKSA9PiB7XG4gICAgcmV0dXJuIHJlcXVpcmUoJ3V1aWQnKVt2XSguLi5hcmdzKVxufVxuZXhwb3J0cy51dWlkID0gdXVpZFxuIl19